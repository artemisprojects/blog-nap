<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description"/><title>ZooKeeper 学习笔记 | NAP</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ZooKeeper 学习笔记</h1><a id="logo" href="/">NAP</a><p class="description">Next Application Platform</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">ZooKeeper 学习笔记</h1><div class="post-meta">2015-12-10 | <span class="categories">分类于<a href="/categories/TVDCR/"> TVDCR</a></span></div><span data-thread-key="2015/12/10/zookeeper-note/" class="ds-thread-count"></span><div class="post-content"><p>ZooKeeper 是一个典型的分布式数据一致性的解决方案，分布式应用可以基于它实现诸如数据发布／订阅、负责均衡、命名服务、分布式协调／通知、<br>集群管理等功能。 ZooKeeper 可以保证如下分布式一致性特征。</p>
<a id="more"></a>
<hr>
<h2 id="ZooKeeper_u662F_u4EC0_u4E48"><a href="#ZooKeeper_u662F_u4EC0_u4E48" class="headerlink" title="ZooKeeper 是什么"></a>ZooKeeper 是什么 </h2><p>ZooKeeper 是一个典型的分布式数据一致性的解决方案，分布式应用可以基于它实现诸如数据发布／订阅、负责均衡、命名服务、分布式协调／通知、<br> 集群管理等功能。 ZooKeeper 可以保证如下分布式一致性特征。</p>
<h3 id="u987A_u5E8F_u4E00_u81F4_u6027"><a href="#u987A_u5E8F_u4E00_u81F4_u6027" class="headerlink" title="顺序一致性"></a>顺序一致性 </h3><p> 从同一个客户端发起的事务请求，最终将会严格地按照其发起顺序被应用到 ZooKeeper 中去</p>
<h3 id="u539F_u5B50_u6027"><a href="#u539F_u5B50_u6027" class="headerlink" title="原子性"></a>原子性 </h3><p> 所有事务请求的处理结果在整个集群中所有机器上的应用情况是一致的，要么整个集群所有机器都成功应用了某一个事务，要么都没有应用</p>
<h3 id="u5355_u4E00_u89C6_u56FE"><a href="#u5355_u4E00_u89C6_u56FE" class="headerlink" title="单一视图"></a>单一视图 </h3><p> 无论客户端连接的是哪个 ZooKeeper 服务器，其看到的服务端数据模型都是一致的。</p>
<h3 id="u53EF_u9760_u6027"><a href="#u53EF_u9760_u6027" class="headerlink" title="可靠性"></a>可靠性 </h3><p> 一旦服务端成功地应用了一个事务，并完成对客户端的响应，那么该事务所引起的服务端状态变更将会被一直保留下来，除非有另一个事务又对其进行了变更。</p>
<h3 id="u5B9E_u65F6_u6027"><a href="#u5B9E_u65F6_u6027" class="headerlink" title="实时性"></a>实时性</h3><p>ZooKeeper 仅仅保证在一定的时间内，客户端最终一定能够从服务器端上读取到最新的数据状态。</p>
<h2 id="ZooKeeper_u63D0_u4F9B_u4E86_u4EC0_u4E48"><a href="#ZooKeeper_u63D0_u4F9B_u4E86_u4EC0_u4E48" class="headerlink" title="ZooKeeper 提供了什么"></a>ZooKeeper 提供了什么 </h2><p> 简单的说，ZooKeeper= 文件系统 + 通知机制。</p>
<h3 id="u6587_u4EF6_u7CFB_u7EDF"><a href="#u6587_u4EF6_u7CFB_u7EDF" class="headerlink" title="文件系统"></a>文件系统</h3><p>ZooKeeper 维护一个类似文件系统的数据结构</p>
<p><img src="/images/zookeeper-file-structure.png" alt=""></p>
<p>每个子目录项如 NameService 都被称作为 znode，和文件系统一样，我们能够自由的增加、删除 znode，在一个 znode 下增加、删除子 znode，唯一的不同在于 znode 是可以存储数据的。有四种类型的 znode：</p>
<ul>
<li>PERSISTENT- 持久化目录节点 <br> 客户端与 zookeeper 断开连接后，该节点依旧存在</li>
<li>PERSISTENT_SEQUENTIAL- 持久化顺序编号目录节点 <br> 客户端与 zookeeper 断开连接后，该节点依旧存在，只是 Zookeeper 给该节点名称进行顺序编号</li>
<li>EPHEMERAL- 临时目录节。客户端与 zookeeper 断开连接后，该节点被删除<br>4、EPHEMERAL_SEQUENTIAL- 临时顺序编号目录节点。客户端与 zookeeper 断开连接后，该节点被删除，只是 Zookeeper 给该节点名称进行顺序编号</li>
</ul>
<h3 id="u901A_u77E5_u673A_u5236"><a href="#u901A_u77E5_u673A_u5236" class="headerlink" title="通知机制"></a>通知机制 </h3><p> 客户端注册监听它关心的目录节点，当目录节点发生变化（数据改变、被删除、子目录节点增加删除）时，ZooKeeper 会通知客户端。</p>
<h2 id="u4FDD_u8BC1_u5206_u5E03_u5F0F_u6570_u636E_u539F_u5B50_u6027_u64CD_u4F5C"><a href="#u4FDD_u8BC1_u5206_u5E03_u5F0F_u6570_u636E_u539F_u5B50_u6027_u64CD_u4F5C" class="headerlink" title="保证分布式数据原子性操作"></a>保证分布式数据原子性操作</h2><p>ZooKeeper 中为数据节点（znode）引入了版本的概念，每个数据节点都具有三种类型的版本信息，说明如下表。</p>
<table>
<thead>
<tr>
<th>版本类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>version</td>
<td>当前数据节点数据内容的版本号 </td>
</tr>
<tr>
<td>cversion</td>
<td>当前数据节点子节点的版本号</td>
</tr>
<tr>
<td>aversion</td>
<td>当前数据节点 ACL 变更版本号</td>
</tr>
</tbody>
</table>
<p>下文以其中的 version 版本类型为例说明。在一个数据节点 <code>/zk</code> 被创建完毕之后，节点的 version 值是 0，表示的含义是“当前节点自创建以后，被更新过 0 次”。如果现在对该节点的数据内容进行更新操作，则 version 的值变为 1。需要注意的是，即使前后两次变更并没有似的数据内容的值发生变化，version 的值依然会变更。</p>
<p>ZooKeeper 引入 version 的作用，主要是实现乐观锁，保证数据原子性操作。乐观锁把控制的事务分成三个阶段：数据读取、写入校验、数据写入，其中写入校验阶段是整个乐观锁控制的关键所在。如何进行写入校验呢？ZooKeeper 采用的是 JDK 中最典型的乐观锁实现——<a href="https://en.wikipedia.org/wiki/Compare-and-swap" target="_blank" rel="external">CAS(Compare and Swap)</a>。简单的讲就是：对于值 V，每次更新前都会比对其值是否是预期值 A，只有符合预期，才会将 V 原子化地更新到新值 B，其中是否符合预期便是乐观锁中的“写入校验”阶段。</p>
<p>下面以一个更新数据实例，演示如何用 version 保证一致性。假如一个客户端试图进行更新操作，它会携带上次获取到的 version 值进行更新。而如果在这段时间内，ZooKeeper 服务器上该节点的数据已经被其他客户端更新了，那么数据版本一定已发生了变化，因此肯定与客户端携带的 version 无法匹配，于是便无法更新成功。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher.Event.EventType;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher.Event.KeeperState;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs.Ids;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.data.Stat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKVersionSample</span> <span class="keyword">implements</span> <span class="title">Watcher</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CountDownLatch connectedSemaphore = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ZooKeeper zk;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String path = <span class="string">"/zk"</span>;</span><br><span class="line">        zk = <span class="keyword">new</span> ZooKeeper(<span class="string">"127.0.0.1:2181"</span>, <span class="number">5000</span>, <span class="keyword">new</span> ZKVersionSample());</span><br><span class="line"></span><br><span class="line">        connectedSemaphore.await();</span><br><span class="line">        zk.create(path, <span class="string">"123"</span>.getBytes(), Ids.OPEN_ACL_UNSAFE,</span><br><span class="line">                CreateMode.EPHEMERAL);</span><br><span class="line">        zk.getData(path, <span class="keyword">true</span>, <span class="keyword">null</span>);</span><br><span class="line">        Stat stat = zk.setData(path, <span class="string">"456"</span>.getBytes(), -<span class="number">1</span>);</span><br><span class="line">        System.out.println(stat.getCzxid() + <span class="string">","</span> + stat.getMzxid() + <span class="string">","</span></span><br><span class="line">                + stat.getVersion());</span><br><span class="line"></span><br><span class="line">        Stat stat2 = zk.setData(path, <span class="string">"456"</span>.getBytes(), stat.getVersion());</span><br><span class="line">        System.out.println(stat2.getCzxid() + <span class="string">","</span> + stat2.getMzxid() + <span class="string">","</span></span><br><span class="line">                + stat2.getVersion());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            zk.setData(path, <span class="string">"456"</span>.getBytes(), stat.getVersion());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">"Error:"</span> + e.code() + <span class="string">","</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(WatchedEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (KeeperState.SyncConnected == event.getState()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (EventType.None == event.getType() &amp;&amp; <span class="keyword">null</span> == event.getPath())&#123;</span><br><span class="line">                connectedSemaphore.countDown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;output</span><br><span class="line"><span class="number">17</span>,<span class="number">18</span>,<span class="number">1</span></span><br><span class="line"><span class="number">17</span>,<span class="number">19</span>,<span class="number">2</span></span><br><span class="line">Error: BADVERSION,KeeperErrorCode = BadVersion <span class="keyword">for</span> /zk</span><br></pre></td></tr></table></figure>
<p>上面的示例程序中，进行了三次更新操作，分别使用了不同的 version。在第一次更新操作中，使用的版本是“－1”，并且更新成功。在 ZooKeeper 中，数据版本都是从 0 开始计数。如果客户端传入的版本参数是“－1”，就是告诉 ZooKeeper 服务端，客户端需要基于数据的最新版本进行更新操作。</p>
<p>在第一次更新操作成功后，ZooKeeper 服务端回返回给客户端一个数据节点的节点状态信息对象：stat。在第二次更新操作中，我们在接口中传入了这个版本号，此时的数据版本变更为“2”。</p>
<p>在第三次操作的时候，程序依然使用了之前的版本“1”进行更新操作，于是更新失败了。</p>
<h2 id="Java_u5BA2_u6237_u7AEFAPI_u4F7F_u7528"><a href="#Java_u5BA2_u6237_u7AEFAPI_u4F7F_u7528" class="headerlink" title="Java 客户端 API 使用"></a>Java 客户端 API 使用</h2><p>ZooKeeper 作为一个分布式服务框架，主要用来解决分布式数据一致性问题，它提供了简单的分布式原语，并且对多种变种语言提供了 API。下面只介绍 ZooKeeper 的 Java 客户端 API 使用方式</p>
<h3 id="u521B_u5EFA_u4F1A_u8BDD"><a href="#u521B_u5EFA_u4F1A_u8BDD" class="headerlink" title="创建会话"></a>创建会话 </h3><p> 客户端可以通过创建一个 ZooKeeper 实例来连接 ZooKeeper 服务器。ZooKeeper 的四种构造方法如下。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ZooKeeper(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher);</span><br><span class="line">ZooKeeper(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher, <span class="keyword">boolean</span> canBeReadOnly);</span><br><span class="line">ZooKeeper(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher, <span class="keyword">long</span> sessionId, <span class="keyword">byte</span>[] sessionPasswd);</span><br><span class="line">ZooKeeper(String connectString, <span class="keyword">int</span> sessionTimeout, Watcher watcher, <span class="keyword">long</span> sessionId, <span class="keyword">byte</span>[] sessionPasswd, <span class="keyword">boolean</span> canBeReadOnly);</span><br></pre></td></tr></table></figure>
<p>以下是 ZooKeeper 构造方法参数说明</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>connectString</td>
<td>指 ZooKeeper 服务器列表，由 host:port 字符串组成。也可以在 connectString 中设置客户端连接上 ZooKeeper 后的根目录。</td>
</tr>
<tr>
<td>sessionTimeout</td>
<td>指会话的超时时间，单位毫秒</td>
</tr>
<tr>
<td>watcher</td>
<td>事件通知器，可以为 null</td>
</tr>
<tr>
<td>canBeReadOnly</td>
<td>用于标示当前会话是否支持”read－only”模式</td>
</tr>
<tr>
<td>sessionId</td>
<td>和 sessionPasswd 分别代表会话 ID 和会话秘钥。客户端使用这两个参数可以实现客户端会话复用</td>
</tr>
</tbody>
</table>
<p>ZooKeeper 客户端和服务器会话的建立是一个异步的过程。当会话真正创建完毕之后，ZooKeeper 服务端会想会话对应的客户端发送一个事件通知。</p>
<p>创建一个最基本的 ZooKeeper 会话实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher.Event.KeeperState; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs.Ids; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKBootSample</span></span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_TIMEOUT = <span class="number">10000</span>; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONNECTION_STRING = <span class="string">"127.0.0.1:2181"</span>; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZK_PATH = <span class="string">"/nileader"</span>; </span><br><span class="line">    <span class="keyword">private</span> ZooKeeper zk = <span class="keyword">null</span>; </span><br><span class="line">     </span><br><span class="line"> 	<span class="keyword">private</span> CountDownLatch connectedSemaphore = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span> ); </span><br><span class="line"> </span><br><span class="line">    <span class="comment">/** </span><br><span class="line">     * 创建 ZK 连接 </span><br><span class="line">     * <span class="doctag">@param</span> connectString  ZK 服务器地址列表 </span><br><span class="line">     * <span class="doctag">@param</span> sessionTimeout   Session 超时时间 </span><br><span class="line">     */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createConnection</span><span class="params">(String connectString, <span class="keyword">int</span> sessionTimeout )</span> </span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            zk = <span class="keyword">new</span> ZooKeeper(connectString, sessionTimeout, <span class="keyword">this</span> ); </span><br><span class="line">            connectedSemaphore.await(); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">            System.out.println(<span class="string">"连接创建失败，发生 InterruptedException"</span> ); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; </span><br><span class="line">            System.out.println(<span class="string">"连接创建失败，发生 IOException"</span> ); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args )</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">        ZKBootSample sample = <span class="keyword">new</span> ZKBootSample(); </span><br><span class="line">        sample.createConnection(CONNECTION_STRING, SESSION_TIMEOUT); </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u521B_u5EFA_u8282_u70B9"><a href="#u521B_u5EFA_u8282_u70B9" class="headerlink" title="创建节点"></a>创建节点 </h3><p> 客户端可以通过 ZooKeeper 的 API 来创建一个数据节点，有如下两个接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">String <span class="title">create</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">byte</span> data[], List&lt;ACL&gt; acl, CreateMode createMode)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">create</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">byte</span> data[], List&lt;ACL&gt; acl, CreateMode createMode, StringCallback cb, Object ctx)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这两个接口分别以同步和异步方式创建节点，参数说明如下表。</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>需要创建的数据节点的节点路径，例如／zk/foo</td>
</tr>
<tr>
<td>data[]</td>
<td>一个字节数组，是创建节点后的初始内容</td>
</tr>
<tr>
<td>acl</td>
<td>节点的 ACL 策略</td>
</tr>
<tr>
<td>createMode</td>
<td>节点类型，有持久、持久顺序、临时、临时顺序</td>
</tr>
<tr>
<td>cb</td>
<td>异步回调函数</td>
</tr>
<tr>
<td>ctx</td>
<td>用于传递一个对象，在回调方法执行的时候使用</td>
</tr>
</tbody>
</table>
<p>无论是同步还是异步接口，ZooKeeper 都不支持递归创建，即无法在父节点不存在的情况下创建一个子节点。如果一个节点已经存在，那么创建同名节点的时候，会抛出 NodeExistsException 异常。</p>
<p>ZooKeeper 的节点内容只支持字节数组（byte[]）类型，不负责为节点内容进行序列化。对于字符串，可以简单的使用”string”.getBytes()来生成一个字节数组，对于其他复杂对象，可以使用 Hessian 或是 Kryo 等序列化工具进行序列化。</p>
<p>使用同步 API 创建一个节点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher.Event.KeeperState; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs.Ids; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper; </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKBootSample</span> <span class="keyword">implements</span> <span class="title">Watcher</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_TIMEOUT = <span class="number">10000</span>; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONNECTION_STRING = <span class="string">"127.0.0.1:2181"</span>; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZK_PATH = <span class="string">"/nileader"</span>; </span><br><span class="line">    <span class="keyword">private</span> ZooKeeper zk = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch connectedSemaphore = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span> );  </span><br><span class="line">     </span><br><span class="line">    <span class="comment">/** </span><br><span class="line">     *  创建节点 </span><br><span class="line">     * <span class="doctag">@param</span> path 节点 path </span><br><span class="line">     * <span class="doctag">@param</span> data 初始数据内容 </span><br><span class="line">     * <span class="doctag">@return</span> </span><br><span class="line">     */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">createPath</span><span class="params">(String path, String data)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            System.out.println(<span class="string">"节点创建成功, Path:"</span> </span><br><span class="line">                    + <span class="keyword">this</span>.zk.create(path, <span class="comment">// </span></span><br><span class="line">                                              data.getBytes(), <span class="comment">// </span></span><br><span class="line">                                              Ids.OPEN_ACL_UNSAFE, <span class="comment">// </span></span><br><span class="line">                                              CreateMode.EPHEMERAL ) </span><br><span class="line">                    + <span class="string">", content:"</span> + data ); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123; </span><br><span class="line">            System.out.println(<span class="string">"节点创建失败，发生 KeeperException"</span> ); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">            System.out.println(<span class="string">"节点创建失败，发生 InterruptedException"</span> ); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args )</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">        ZKBootSample sample = <span class="keyword">new</span> ZKBootSample(); </span><br><span class="line">        sample.createConnection(CONNECTION_STRING, SESSION_TIMEOUT); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sample.createPath( ZK_PATH, <span class="string">"我是节点初始内容"</span> ) ) &#123; </span><br><span class="line">            <span class="comment">//do something</span></span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u5220_u9664_u8282_u70B9"><a href="#u5220_u9664_u8282_u70B9" class="headerlink" title="删除节点"></a>删除节点 </h3><p> 客户端可以通过 ZooKeeper 的 API 来删除一个节点，有如下两个接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">int</span> version)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">int</span> version, VoidCallBack cb, Object ctx)</span></span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>需要删除的数据节点的节点路径，例如／zk/foo</td>
</tr>
<tr>
<td>version</td>
<td>指定节点的数据版本，即表明本次删除操作是针对该数据版本进行的</td>
</tr>
<tr>
<td>cb</td>
<td>异步回调函数</td>
</tr>
<tr>
<td>ctx</td>
<td>用于传递一个对象，在回调方法执行的时候使用</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher.Event.KeeperState; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs.Ids; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper; </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKBootSample</span> <span class="keyword">implements</span> <span class="title">Watcher</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_TIMEOUT = <span class="number">10000</span>; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONNECTION_STRING = <span class="string">"127.0.0.1:2181"</span>; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZK_PATH = <span class="string">"/nileader"</span>; </span><br><span class="line">    <span class="keyword">private</span> ZooKeeper zk = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch connectedSemaphore = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span> );  </span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span><br><span class="line">     * 删除指定节点 </span><br><span class="line">     * <span class="doctag">@param</span> path 节点 path </span><br><span class="line">     */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteNode</span><span class="params">(String path)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            <span class="keyword">this</span>.zk.delete(path, -<span class="number">1</span> ); </span><br><span class="line">            System.out.println(<span class="string">"删除节点成功，path："</span> + path ); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123; </span><br><span class="line">            System.out.println(<span class="string">"删除节点失败，发生 KeeperException，path:"</span> + path  ); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">            System.out.println(<span class="string">"删除节点失败，发生 InterruptedException，path:"</span> + path  ); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;  </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args )</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">        ZKBootSample sample = <span class="keyword">new</span> ZKBootSample(); </span><br><span class="line">        sample.createConnection(CONNECTION_STRING, SESSION_TIMEOUT); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sample.createPath( ZK_PATH, <span class="string">"我是节点初始内容"</span> ) ) &#123; </span><br><span class="line">            <span class="comment">//do something</span></span><br><span class="line">            sample.deleteNode(ZK_PATH); </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u8BFB_u53D6_u6570_u636E"><a href="#u8BFB_u53D6_u6570_u636E" class="headerlink" title="读取数据"></a>读取数据 </h3><p> 读取数据， 包括自节点列表的获取和节点数据的获取。ZooKeeper 分别提供了不同的 API 来获取数据。</p>
<h4 id="getChildren"><a href="#getChildren" class="headerlink" title="getChildren"></a>getChildren</h4><p>客户端可以通过 ZooKeeper 的 API 来获取一个节点的所有子节点，有如下 4 个接口可以使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;String&gt; <span class="title">getChildren</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher)</span></span>;</span><br><span class="line"><span class="function">List&lt;String&gt; <span class="title">getChildren</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">boolean</span> watch)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getChildren</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, ChildrenCallback cb, Object ctx)</span></span>;</span><br><span class="line"><span class="function">List&lt;String&gt; <span class="title">getChildren</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, Stat stat)</span></span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>指定数据节点的节点路径，例如／zk/foo</td>
</tr>
<tr>
<td>watcher</td>
<td>注册的 Watcher。一旦本次子节点获取之后，当子节点列表发生变更，那么就会向客户端发送通知。该参数允许传入 null</td>
</tr>
<tr>
<td>watch</td>
<td>表明是否需要一个 Watcher。如果这个参数是 true，那么 ZooKeeper 客户端会自动使用程序上文中提到的那个默认 Watcher</td>
</tr>
<tr>
<td>cb</td>
<td>异步回调函数</td>
</tr>
<tr>
<td>ctx</td>
<td>用于传递一个对象，在回调方法执行的时候使用</td>
</tr>
<tr>
<td>stat</td>
<td>指定数据节点的节点状态。用法是在接口中传入一个旧的 stat 变量，该 stat 变量会在方法执行过程中，被来自服务端响应的新 stat 对象替换</td>
</tr>
</tbody>
</table>
<p>stat 用于描述节点状态信息，该对象纪录了一个节点的基本属性信息，例如节点创建时的事务 ID、最后一次修改的事务 ID 和节点数据内容的长度等。</p>
<h4 id="getData"><a href="#getData" class="headerlink" title="getData"></a>getData</h4><p>客户端可以通过 ZooKeeper 的 API 来获取一个节点的所有子节点，有如下 4 个接口可以使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] getData(<span class="keyword">final</span> String path, Watcher watcher, Stat stat);</span><br><span class="line"><span class="keyword">byte</span>[] getData(<span class="keyword">final</span> String path, <span class="keyword">boolean</span> watch, Stat stat);</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getData</span><span class="params">(<span class="keyword">final</span> String path, Watcher watcher, DataCallback cb, Object ctx)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getData</span><span class="params">(<span class="keyword">final</span> String path, <span class="keyword">boolean</span> watch, DataCallback cb, Object ctx)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数说明痛 getChildren。一个简单的读取数据实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException; </span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.WatchedEvent; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.Watcher.Event.KeeperState; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs.Ids; </span><br><span class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper; </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZKBootSample</span> <span class="keyword">implements</span> <span class="title">Watcher</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SESSION_TIMEOUT = <span class="number">10000</span>; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONNECTION_STRING = <span class="string">"127.0.0.1:2181"</span>; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZK_PATH = <span class="string">"/nileader"</span>; </span><br><span class="line">    <span class="keyword">private</span> ZooKeeper zk = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CountDownLatch connectedSemaphore = <span class="keyword">new</span> CountDownLatch(<span class="number">1</span> );  </span><br><span class="line"> </span><br><span class="line"> 	<span class="comment">/** </span><br><span class="line">     * 读取指定节点数据内容 </span><br><span class="line">     * <span class="doctag">@param</span> path 节点 path </span><br><span class="line">     * <span class="doctag">@return</span> </span><br><span class="line">     */</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">readData</span><span class="params">(String path)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            System.out.println(<span class="string">"获取数据成功，path："</span> + path ); </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(<span class="keyword">this</span>.zk.getData(path, <span class="keyword">false</span>, <span class="keyword">null</span> ) ); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (KeeperException e) &#123; </span><br><span class="line">            System.out.println(<span class="string">"读取数据失败，发生 KeeperException，path:"</span> + path  ); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>; </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; </span><br><span class="line">            System.out.println(<span class="string">" 读取数据失败，发生 InterruptedException，path: "</span> + path  ); </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args )</span> </span>&#123; </span><br><span class="line"> </span><br><span class="line">        ZKBootSample sample = <span class="keyword">new</span> ZKBootSample(); </span><br><span class="line">        sample.createConnection(CONNECTION_STRING, SESSION_TIMEOUT); </span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sample.createPath( ZK_PATH, <span class="string">"我是节点初始内容"</span> ) ) &#123; </span><br><span class="line">            <span class="comment">//do something</span></span><br><span class="line">            System.out.println(<span class="string">"数据内容:"</span> + sample.readData(ZK_PATH) + <span class="string">"\n"</span> ); </span><br><span class="line">        &#125; </span><br><span class="line"> </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/dynamic-reconfiguration/">dynamic reconfiguration</a><a href="/tags/spring/">spring</a><a href="/tags/transacion/">transacion</a></div><div class="post-nav"><a href="/2015/12/18/hotSwapAgent-not/" class="pre"><i class="icon-previous">Hotswap Agent 学习笔记</i></a><a href="/2015/12/02/openstack_neutron/" class="next">OpenStack 平台 Neutron 服务初探<i class="icon-next"></i></a></div><div data-thread-key="2015/12/10/zookeeper-note/" data-title="ZooKeeper 学习笔记" data-url="http://nap-blog.artemisprojects.org/2015/12/10/zookeeper-note/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2015/12/10/zookeeper-note/" data-title="ZooKeeper 学习笔记" data-url="http://nap-blog.artemisprojects.org/2015/12/10/zookeeper-note/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://nap-blog.artemisprojects.org"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/OpenStack/">OpenStack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TVDCR/">TVDCR</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/east/">east</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nap/">nap</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/mesos/" style="font-size: 15px;">mesos</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/dynamic-reconfiguration/" style="font-size: 15px;">dynamic reconfiguration</a> <a href="/tags/restful/" style="font-size: 15px;">restful</a> <a href="/tags/rest/" style="font-size: 15px;">rest</a> <a href="/tags/OpenStack/" style="font-size: 15px;">OpenStack</a> <a href="/tags/Neutron/" style="font-size: 15px;">Neutron</a> <a href="/tags/floating-ip/" style="font-size: 15px;">floating-ip</a> <a href="/tags/nap/" style="font-size: 15px;">nap</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/compose/" style="font-size: 15px;">compose</a> <a href="/tags/transacion/" style="font-size: 15px;">transacion</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/Hive/" style="font-size: 15px;">Hive</a> <a href="/tags/Tez/" style="font-size: 15px;">Tez</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/api/" style="font-size: 15px;">api</a> <a href="/tags/ORM/" style="font-size: 15px;">ORM</a> <a href="/tags/nosql/" style="font-size: 15px;">nosql</a> <a href="/tags/schema/" style="font-size: 15px;">schema</a> <a href="/tags/east/" style="font-size: 15px;">east</a> <a href="/tags/openstack/" style="font-size: 15px;">openstack</a> <a href="/tags/devstack/" style="font-size: 15px;">devstack</a></div></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://artemisprojects.org/" title="Artemis Projects" target="_blank">Artemis Projects</a><ul></ul><a href="http://www.nju.edu.cn/" title="Nanjing Univ." target="_blank">Nanjing Univ.</a><ul></ul><a href="http://chun.nemoworks.info/" title="Chun CAO" target="_blank">Chun CAO</a><ul></ul><a href="http://jetmuffin.github.io/" title="Jie CHEN" target="_blank">Jie CHEN</a><ul></ul><a href="http://cshuo.github.io/" title="Shuo CHEN" target="_blank">Shuo CHEN</a><ul></ul><a href="http://NAP-GHJ.github.io" title="Hongjun GE" target="_blank">Hongjun GE</a><ul></ul><a href="http://itanch.github.io" title="Tianchi LIU" target="_blank">Tianchi LIU</a><ul></ul><a href="http://Luziling.github.io" title="Ziling LU" target="_blank">Ziling LU</a><ul></ul><a href="http://dmemoing.github.io" title="Jing DENG" target="_blank">Jing DENG</a><ul></ul><a href="http://rdmclin2.github.io/" title="Chenglin MENG" target="_blank">Chenglin MENG</a><ul></ul><a href="http://co2y.github.io/" title="Weiyi WANG" target="_blank">Weiyi WANG</a><ul></ul><a href="http://qunnn41.github.io" title="Yiqun WANG" target="_blank">Yiqun WANG</a><ul></ul><a href="http://flyxu.github.io" title="Xiang XU" target="_blank">Xiang XU</a><ul></ul><a href="http://monkey-h.github.io/" title="Zhongliang YUAN" target="_blank">Zhongliang YUAN</a><ul></ul><a href="http://ying-zhang.github.io/" title="Ying ZHANG" target="_blank">Ying ZHANG</a></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/03/15/hadoop_hive_tez/">Hadoop, Hive, Tez 搭建笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/10/nap-doc/">NAP 使用手册</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/30/photos/">我们的 2015</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/18/hotSwapAgent-not/">Hotswap Agent 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/10/zookeeper-note/">ZooKeeper 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/02/openstack_neutron/">OpenStack 平台 Neutron 服务初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/20/openstack_floating_ip/">OpenStack 平台手动搭建以及 floating-ip 的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/19/fcws-api-doc/">凤城卫士 API 文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/10/spring-transaction-manager/">Spring Transaction Manager 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/09/devstack-1/">OpenStack 与 DevStack 初探</a></li></ul></div><div class="widget"><div class="comments-title">最近评论</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">NAP.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>var duoshuoQuery = {short_name:'yingz'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//dn-comment.qbox.me/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script></div></body></html>