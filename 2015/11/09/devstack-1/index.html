<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="telephone=no" name="format-detection"/><meta name="description"/><title>OpenStack 与 DevStack 初探 | NAP</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"/><link rel="stylesheet" type="text/css" href="/css/pure-min.css"/><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"/><link rel="stylesheet" type="text/css" href="/css/style.css"/><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"/><link rel="alternate" type="application/atom+xml" href="/atom.xml"/></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OpenStack 与 DevStack 初探</h1><a id="logo" href="/">NAP</a><p class="description">Next Application Platform</p></div><div id="nav-menu"><a href="/" class="current"><i class="icon-home"> 首页</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">OpenStack 与 DevStack 初探</h1><div class="post-meta">2015-11-09 | <span class="categories">分类于<a href="/categories/OpenStack/"> OpenStack</a></span></div><span data-thread-key="2015/11/09/devstack-1/" class="ds-thread-count"></span><div class="post-content"><p>本文会简单介绍一下 OpenStack 平台，它的手动部署方法，以及使用 devstack 脚本自动化部署的方法。</p>
<a id="more"></a>
<hr>
<h2 id="OpenStack_u7B80_u4ECB"><a href="#OpenStack_u7B80_u4ECB" class="headerlink" title="OpenStack 简介"></a>OpenStack 简介</h2><p>OpenStack 是一个开元的云计算管理平台项目，由几个主要的组件组合起来完成具体任务。OpenStack 支持几乎所有类型的云环境，它的目标是提供实施简单、可大规模扩展、丰富、标准统一的云计算管理平台。它的主要组件及相应的功能如下图所示：</p>
<p><img src="/images/openstack-service.png" alt=""></p>
<h3 id="u624B_u52A8_u642D_u5EFAOpenStack_u5E73_u53F0"><a href="#u624B_u52A8_u642D_u5EFAOpenStack_u5E73_u53F0" class="headerlink" title="手动搭建 OpenStack 平台"></a>手动搭建 OpenStack 平台 </h3><p> 我们选择的平台是 Ubuntu14.04。根据 <a href="http://docs.openstack.org/liberty/install-guide-ubuntu/" target="_blank" rel="external"> 官方文档 </a>，我们可以手动部署 OpenStack 的各个服务组件。在部署服务之前，需要首先安装 NTP，以及数据库和消息队列组件。其中 NTP 是为了保证集群中的所有结点有一个全局时钟。而数据库存放每个服务的数据等信息，OpenStack 支持 MySQL 和 MongoDB。消息队列被用来协调各个服务之间的操作和状态，一般用<a href="http://www.rabbitmq.com/" target="_blank" rel="external">RabbitMQ</a> 实现。</p>
<p>每个服务的安装部署过程都比较类似。首先会建立一个数据库，然后建立一个用户，接着安装依赖的包等等。最后手动修改配置文件(主要为 /etc/service_name/service_name.conf)。</p>
<h2 id="DevStack_u7B80_u4ECB"><a href="#DevStack_u7B80_u4ECB" class="headerlink" title="DevStack 简介"></a>DevStack 简介</h2><p>DevStack 实际上是一个 shell 脚本，可以用来快速搭建 OpenStack 的运行和开发环境，但是 devstack 并不适合用在生产环境中，它比较适合 OpenStack 开发者下载最新的 OpenStack 代码迅速在自己的笔记本上搭建一个开发环境出来。</p>
<h3 id="u4F7F_u7528DevStack_u811A_u672C_u8FDB_u884C_u4E00_u952E_u90E8_u7F72"><a href="#u4F7F_u7528DevStack_u811A_u672C_u8FDB_u884C_u4E00_u952E_u90E8_u7F72" class="headerlink" title="使用 DevStack 脚本进行一键部署"></a>使用 DevStack 脚本进行一键部署 </h3><p> 使用 devstack 脚本很简单，安装 git，然后下载 devstack 代码到本地，运行 stack.sh 脚本一次设定 MySQL, RabbitMQ, OpenStack Dashboard 和 Keystone 的密码，密码输入后 stack.sh 脚本会自动开始安装必要的软件包和库并下载最新的 OpenStack 及其组件代码，整个过程无需干预。devstack 的下载方式：</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://git.openstack.org/openstack-dev/devstack</span><br></pre></td></tr></table></figure>
<p>Devstack 的默认配置文件都保存在 stackrc 文件中，我们也可以创建一个 localrc 文件来修改他的默认设置。它的使用比较简单，但是它的脚本代码一点都不简单，因为它要维护支持多 Linux 发行版。通过阅读脚本，并且与 stack.sh 源码对照。将整个过程自动分为以下若干步骤：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">清楚上次 devstack 脚本运行的缓存。</span><br><span class="line">根据 stackrc/localrc 等配置文件加载一些系统变量及其他配置选项 </span><br><span class="line"> 载入本地变量，根据不同的 Linux 版本进行不同的操作。（详细的操作步骤目前还不是特别熟悉，需要的时候再看）</span><br><span class="line">配置安装及 <span class="built_in">log</span> 目录等信息。</span><br><span class="line">预先设定错误处理过程，即如果在脚本运行过程中发生错误，需要在退出前进行哪些操作。</span><br><span class="line">导入每个 OpenStack 服务所需要的 plugins 或是安装服务所用到的 libraries 及 <span class="built_in">functions</span>。</span><br><span class="line"> 交互配置，及提供 MySQL,RabbitMQ,Dashboard 以及 Keystone 的密码。</span><br><span class="line">安装 database 及队列 queue。</span><br><span class="line">安装配置本地的 python 环境。</span><br><span class="line">安装 service client。</span><br><span class="line">安装 service middleware（即每个需要安装的具体服务）。</span><br><span class="line">初始化并启动这些服务。</span><br><span class="line">保存安装过程退出后，在运行时可能用到的信息，如相关的系统变量等等。</span><br><span class="line">打印安装完成的信息。</span><br></pre></td></tr></table></figure>
<h3 id="u5BF9_u6BD4devstack_u90E8_u7F72_u4EE5_u53CA_u624B_u52A8_u90E8_u7F72_u7684_u8FC7_u7A0B_uFF0C_u4EE5nova_u670D_u52A1_u4E3A_u4F8B_u3002"><a href="#u5BF9_u6BD4devstack_u90E8_u7F72_u4EE5_u53CA_u624B_u52A8_u90E8_u7F72_u7684_u8FC7_u7A0B_uFF0C_u4EE5nova_u670D_u52A1_u4E3A_u4F8B_u3002" class="headerlink" title="对比 devstack 部署以及手动部署的过程，以 nova 服务为例。"></a>对比 devstack 部署以及手动部署的过程，以 nova 服务为例。</h3><h4 id="u624B_u52A8_u90E8_u7F72"><a href="#u624B_u52A8_u90E8_u7F72" class="headerlink" title="手动部署"></a>手动部署</h4><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE nova DATABASE<span class="comment">;</span></span><br><span class="line">CREATE nova Users<span class="comment">;</span></span><br><span class="line">CREATE compute service API endpoint<span class="comment">;</span></span><br><span class="line">apt-get install $(packages)<span class="comment">;</span></span><br><span class="line">vim /etc/nova/nova.conf<span class="comment">;</span></span><br><span class="line">service $(*) restart<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h4 id="u81EA_u52A8_u90E8_u7F72_28stack-sh_29"><a href="#u81EA_u52A8_u90E8_u7F72_28stack-sh_29" class="headerlink" title="自动部署 (stack.sh)"></a> 自动部署(stack.sh)</h4><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Line756, install_nov<span class="built_in">a_client</span>.</span><br><span class="line">Line811, stack_install_nova, 这两个函数主要进行的就是 git clone 和 pip install, 即下载安装所需依赖包。</span><br><span class="line">Line815, configure_nova，主要对 /etc/nova/nova.conf 进行配置。</span><br><span class="line">Line1131, init_nova, 主要进行初始化数据库等。</span><br><span class="line">Line1252, start_nova，启动 nova 服务。</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/devstack/">devstack</a><a href="/tags/openstack/">openstack</a></div><div class="post-nav"><a href="/2015/11/10/spring-transaction-manager/" class="pre"><i class="icon-previous">Spring Transaction Manager 学习笔记</i></a><a href="/2015/11/09/nap-restapi/" class="next">Restful Api for NAP<i class="icon-next"></i></a></div><div data-thread-key="2015/11/09/devstack-1/" data-title="OpenStack 与 DevStack 初探" data-url="http://nap-blog.artemisprojects.org/2015/11/09/devstack-1/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2015/11/09/devstack-1/" data-title="OpenStack 与 DevStack 初探" data-url="http://nap-blog.artemisprojects.org/2015/11/09/devstack-1/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://nap-blog.artemisprojects.org"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/OpenStack/">OpenStack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TVDCR/">TVDCR</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/east/">east</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nap/">nap</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/mesos/" style="font-size: 15px;">mesos</a> <a href="/tags/spring/" style="font-size: 15px;">spring</a> <a href="/tags/dynamic-reconfiguration/" style="font-size: 15px;">dynamic reconfiguration</a> <a href="/tags/restful/" style="font-size: 15px;">restful</a> <a href="/tags/rest/" style="font-size: 15px;">rest</a> <a href="/tags/OpenStack/" style="font-size: 15px;">OpenStack</a> <a href="/tags/Neutron/" style="font-size: 15px;">Neutron</a> <a href="/tags/floating-ip/" style="font-size: 15px;">floating-ip</a> <a href="/tags/nap/" style="font-size: 15px;">nap</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/compose/" style="font-size: 15px;">compose</a> <a href="/tags/transacion/" style="font-size: 15px;">transacion</a> <a href="/tags/hadoop/" style="font-size: 15px;">hadoop</a> <a href="/tags/Hive/" style="font-size: 15px;">Hive</a> <a href="/tags/Tez/" style="font-size: 15px;">Tez</a> <a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/api/" style="font-size: 15px;">api</a> <a href="/tags/ORM/" style="font-size: 15px;">ORM</a> <a href="/tags/nosql/" style="font-size: 15px;">nosql</a> <a href="/tags/schema/" style="font-size: 15px;">schema</a> <a href="/tags/east/" style="font-size: 15px;">east</a> <a href="/tags/openstack/" style="font-size: 15px;">openstack</a> <a href="/tags/devstack/" style="font-size: 15px;">devstack</a></div></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://artemisprojects.org/" title="Artemis Projects" target="_blank">Artemis Projects</a><ul></ul><a href="http://www.nju.edu.cn/" title="Nanjing Univ." target="_blank">Nanjing Univ.</a><ul></ul><a href="http://chun.nemoworks.info/" title="Chun CAO" target="_blank">Chun CAO</a><ul></ul><a href="http://jetmuffin.github.io/" title="Jie CHEN" target="_blank">Jie CHEN</a><ul></ul><a href="http://cshuo.github.io/" title="Shuo CHEN" target="_blank">Shuo CHEN</a><ul></ul><a href="http://NAP-GHJ.github.io" title="Hongjun GE" target="_blank">Hongjun GE</a><ul></ul><a href="http://itanch.github.io" title="Tianchi LIU" target="_blank">Tianchi LIU</a><ul></ul><a href="http://Luziling.github.io" title="Ziling LU" target="_blank">Ziling LU</a><ul></ul><a href="http://dmemoing.github.io" title="Jing DENG" target="_blank">Jing DENG</a><ul></ul><a href="http://rdmclin2.github.io/" title="Chenglin MENG" target="_blank">Chenglin MENG</a><ul></ul><a href="http://co2y.github.io/" title="Weiyi WANG" target="_blank">Weiyi WANG</a><ul></ul><a href="http://qunnn41.github.io" title="Yiqun WANG" target="_blank">Yiqun WANG</a><ul></ul><a href="http://flyxu.github.io" title="Xiang XU" target="_blank">Xiang XU</a><ul></ul><a href="http://monkey-h.github.io/" title="Zhongliang YUAN" target="_blank">Zhongliang YUAN</a><ul></ul><a href="http://ying-zhang.github.io/" title="Ying ZHANG" target="_blank">Ying ZHANG</a></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/03/15/hadoop_hive_tez/">Hadoop, Hive, Tez 搭建笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/10/nap-doc/">NAP 使用手册</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/30/photos/">我们的 2015</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/18/hotSwapAgent-not/">Hotswap Agent 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/10/zookeeper-note/">ZooKeeper 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/02/openstack_neutron/">OpenStack 平台 Neutron 服务初探</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/20/openstack_floating_ip/">OpenStack 平台手动搭建以及 floating-ip 的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/19/fcws-api-doc/">凤城卫士 API 文档</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/10/spring-transaction-manager/">Spring Transaction Manager 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/09/devstack-1/">OpenStack 与 DevStack 初探</a></li></ul></div><div class="widget"><div class="comments-title">最近评论</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div></div><div id="footer">© <a href="/" rel="nofollow">NAP.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>var duoshuoQuery = {short_name:'yingz'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//dn-comment.qbox.me/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script></div></body></html>